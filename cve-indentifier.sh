#!/bin/bash

# Solicitamos al usuario que ingrese la dirección IP
echo "Ingrese la dirección IP: "
read ip

# Ejecutamos el comando nmap para escanear la dirección IP
# y buscar vulnerabilidades, y utilizamos el formato grepeable para facilitar
# el procesamiento posterior de los resultados
resultado=$(nmap -sV -sC  -p- -vvv -Pn --script vuln --script http-fuzzer -oG - $ip)

# Creamos un archivo de texto para guardar la información
echo "$resultado" > date.txt

# Verificamos si se han encontrado vulnerabilidades
if [ "$resultado" != "" ]
then
  # Mostramos un mensaje informando que se han encontrado vulnerabilidades
  echo "Se han encontrado vulnerabilidades:"

  # Recorremos cada línea del resultado
  while read -r line; do
    # Si la línea comienza con "|_" es una vulnerabilidad
    if [[ "$line" == \|_* ]]
    then
      # Mostramos la vulnerabilidad
      echo "$line"
    fi
  done <<< "$resultado"
else
  # Si no se han encontrado vulnerabilidades, mostramos un mensaje informando
  echo "No se han encontrado vulnerabilidades"
fi